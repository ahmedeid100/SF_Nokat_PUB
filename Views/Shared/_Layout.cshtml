<!DOCTYPE html>
<html>
<head>
    <script src="@Url.Content("~/Scripts/jquery-1.7.2.min.js")" type="text/javascript"></script>
    <link href="@Url.Content("~/Content/Site.css")" rel="stylesheet" type="text/css" />
</head>
<body>
    <div>
        <img alt="My Nokat" width=""  src="../../Content/images/logo.jpg" />
    </div>
    <div >
    @*<input type="submit" id="inviteFriends" value="Invite Friends" onclick="invite();"/>*@
    <input type="button"
      onclick="sendRequestViaMultiFriendSelector(); return false;"
      value="Send Request to Many Users with MFS"
    />
    </div>
    <div id="MainContent">
    </div>
    <div id="fb-root">
       @* <div class="fb-login-button" data-show-faces="true" data-width="400" data-max-rows="1">
        </div>*@
    </div>
    @Html.Hidden("FBID", "")
    @Html.Hidden("Name", "")
    @Html.Hidden("access_token", "")
    @Html.Hidden("memberID", "")
    <script type="text/javascript" language="javascript">
        window.fbAsyncInit = function () {
            FB.init({
                appId: '323528921058969', // App ID
                channelUrl: 'http://mynokat-1.apphb.com/channel.html', // Channel File
                status: true, // check login status
                cookie: true, // enable cookies to allow the server to access the session
                xfbml: true  // parse XFBML
                //frictionlessRequests: true
            });

            // Additional initialization code here

            FB.Event.subscribe('auth.login', function (response) {
                login();
            });

            login();

        };

    // Load the SDK Asynchronously
    (function (d) {
        var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
        if (d.getElementById(id)) { return; }
        js = d.createElement('script'); js.id = id; js.async = true;
        js.src = "//connect.facebook.net/en_US/all.js";
        ref.parentNode.insertBefore(js, ref);
    } (document));


    function login() {
        FB.login(function (response) {
            if (response.authResponse) {
                FB.api('/me', function (response1) {
                    $("#FBID").val(response1.id);
                    $("#Name").val(response1.name);
                    $("#access_token").val(response.authResponse.accessToken);

                    var fbid = $("#FBID").val();
                    var name = $("#Name").val();
                    alert(fbid);
                    $.post("/Joke/AddMember", { FBID: fbid, Name: name }, function (data) {
                        $("#memberID").val(data); //alert(data);
                    });
                });

            } else {
                //console.log('User cancelled login or did not fully authorize.');
            }

        });
    }

     
      function sendRequestViaMultiFriendSelector() {
          FB.ui({ method: 'apprequests',
              message: 'My Great Request'
          }, function (responce) { });
      }

    </script>
    @RenderBody()
</body>
</html>
